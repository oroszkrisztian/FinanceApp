{"version":3,"file":"loginEmailService.js","sourceRoot":"","sources":["../../../src/services/loginEmailService.ts"],"names":[],"mappings":";;;;;AAAA,kEAIwB;AAUxB,MAAM,iBAAiB;IACb,YAAY,CAAoB;IAChC,WAAW,CAAS;IACpB,UAAU,CAAS;IAE3B;QACE,MAAM,MAAM,GAAG,OAAO,CAAC,GAAG,CAAC,aAAa,CAAC;QACzC,IAAI,CAAC,MAAM,EAAE,CAAC;YACZ,MAAM,IAAI,KAAK,CAAC,gDAAgD,CAAC,CAAC;QACpE,CAAC;QAED,IAAI,CAAC,YAAY,GAAG,IAAI,sBAAiB,CAAC,MAAM,CAAC,CAAC;QAClD,IAAI,CAAC,WAAW,GAAG,OAAO,CAAC,GAAG,CAAC,kBAAkB,IAAI,wBAAwB,CAAC;QAC9E,IAAI,CAAC,UAAU,GAAG,OAAO,CAAC,GAAG,CAAC,iBAAiB,IAAI,aAAa,CAAC;IACnE,CAAC;IAED,KAAK,CAAC,qBAAqB,CAAC,IAAoB;QAC9C,IAAI,CAAC;YACH,MAAM,SAAS,GAA2B;gBACxC,MAAM,EAAE;oBACN,IAAI,EAAE,IAAI,CAAC,UAAU;oBACrB,KAAK,EAAE,IAAI,CAAC,WAAW;iBACxB;gBACD,EAAE,EAAE;oBACF;wBACE,KAAK,EAAE,IAAI,CAAC,SAAS;wBACrB,IAAI,EAAE,IAAI,CAAC,QAAQ;qBACpB;iBACF;gBACD,OAAO,EAAE,uCAAuC;gBAChD,WAAW,EAAE,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC;gBAC9C,WAAW,EAAE,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC;gBAC9C,IAAI,EAAE,CAAC,oBAAoB,CAAC;aAC7B,CAAC;YAEF,MAAM,IAAI,CAAC,YAAY,CAAC,sBAAsB,CAAC,SAAS,CAAC,CAAC;YAC1D,OAAO,CAAC,GAAG,CAAC,oCAAoC,IAAI,CAAC,SAAS,EAAE,CAAC,CAAC;QACpE,CAAC;QAAC,OAAO,KAAK,EAAE,CAAC;YACf,OAAO,CAAC,KAAK,CAAC,0CAA0C,EAAE,KAAK,CAAC,CAAC;QACnE,CAAC;IACH,CAAC;IAEO,sBAAsB,CAAC,IAAoB;QACjD,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,cAAc,EAAE,CAAC;QAClD,MAAM,MAAM,GAAG,IAAI,CAAC,SAAS;YAC3B,CAAC,CAAC,mCAAmC,IAAI,CAAC,SAAS,MAAM;YACzD,CAAC,CAAC,EAAE,CAAC;QACP,MAAM,aAAa,GAAG,IAAI,CAAC,SAAS;YAClC,CAAC,CAAC,+BAA+B,IAAI,CAAC,SAAS,MAAM;YACrD,CAAC,CAAC,EAAE,CAAC;QAEP,OAAO;;;;;;;;;;;;;;;;;;;;;;;8BAuBmB,IAAI,CAAC,QAAQ;;;;;wCAKH,SAAS;cACnC,MAAM;cACN,aAAa;;;;;;;;;;;;;KAatB,CAAC;IACJ,CAAC;IAEO,sBAAsB,CAAC,IAAoB;QACjD,MAAM,SAAS,GAAG,IAAI,CAAC,SAAS,CAAC,cAAc,EAAE,CAAC;QAClD,MAAM,MAAM,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,eAAe,IAAI,CAAC,SAAS,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;QACvE,MAAM,aAAa,GAAG,IAAI,CAAC,SAAS,CAAC,CAAC,CAAC,WAAW,IAAI,CAAC,SAAS,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC;QAE1E,OAAO;;;QAGH,IAAI,CAAC,QAAQ;;;;;QAKb,SAAS;EACf,MAAM,GAAG,aAAa;;;;;;;KAOnB,CAAC,IAAI,EAAE,CAAC;IACX,CAAC;CACF;AAED,kBAAe,iBAAiB,CAAC","sourcesContent":["import BrevoEmailService, {\n  TransactionalEmailData,\n  EmailSender,\n  EmailRecipient,\n} from \"./brevoService\";\n\ninterface LoginEmailData {\n  userEmail: string;\n  userName: string;\n  loginTime: Date;\n  ipAddress?: string;\n  userAgent?: string;\n}\n\nclass LoginEmailService {\n  private brevoService: BrevoEmailService;\n  private senderEmail: string;\n  private senderName: string;\n\n  constructor() {\n    const apiKey = process.env.BREVO_API_KEY;\n    if (!apiKey) {\n      throw new Error(\"BREVO_API_KEY environment variable is required\");\n    }\n\n    this.brevoService = new BrevoEmailService(apiKey);\n    this.senderEmail = process.env.BREVO_SENDER_EMAIL || \"noreply@financeapp.com\";\n    this.senderName = process.env.BREVO_SENDER_NAME || \"Finance App\";\n  }\n\n  async sendLoginNotification(data: LoginEmailData): Promise<void> {\n    try {\n      const emailData: TransactionalEmailData = {\n        sender: {\n          name: this.senderName,\n          email: this.senderEmail,\n        },\n        to: [\n          {\n            email: data.userEmail,\n            name: data.userName,\n          },\n        ],\n        subject: \"New Login to Your Finance App Account\",\n        htmlContent: this.generateLoginEmailHTML(data),\n        textContent: this.generateLoginEmailText(data),\n        tags: [\"login-notification\"],\n      };\n\n      await this.brevoService.sendTransactionalEmail(emailData);\n      console.log(`Login notification email sent to ${data.userEmail}`);\n    } catch (error) {\n      console.error(\"Failed to send login notification email:\", error);\n    }\n  }\n\n  private generateLoginEmailHTML(data: LoginEmailData): string {\n    const loginTime = data.loginTime.toLocaleString();\n    const ipInfo = data.ipAddress\n      ? `<p><strong>IP Address:</strong> ${data.ipAddress}</p>`\n      : \"\";\n    const userAgentInfo = data.userAgent\n      ? `<p><strong>Device:</strong> ${data.userAgent}</p>`\n      : \"\";\n\n    return `\n      <!DOCTYPE html>\n      <html>\n      <head>\n        <meta charset=\"utf-8\">\n        <title>New Login Notification</title>\n        <style>\n          body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; }\n          .container { max-width: 600px; margin: 0 auto; padding: 20px; }\n          .header { background-color: #f8f9fa; padding: 20px; border-radius: 5px; margin-bottom: 20px; }\n          .content { background-color: #ffffff; padding: 20px; border: 1px solid #dee2e6; border-radius: 5px; }\n          .footer { margin-top: 20px; font-size: 12px; color: #6c757d; }\n          .alert { background-color: #fff3cd; border: 1px solid #ffeaa7; padding: 15px; border-radius: 5px; margin-bottom: 20px; }\n        </style>\n      </head>\n      <body>\n        <div class=\"container\">\n          <div class=\"header\">\n            <h2>üîê New Login Notification</h2>\n          </div>\n          \n          <div class=\"content\">\n            <div class=\"alert\">\n              <strong>Hello ${data.userName},</strong><br>\n              We detected a new login to your Finance App account.\n            </div>\n            \n            <h3>Login Details:</h3>\n            <p><strong>Time:</strong> ${loginTime}</p>\n            ${ipInfo}\n            ${userAgentInfo}\n            \n            <p>If this was you, you can safely ignore this email. If you don't recognize this login, please contact our support team immediately.</p>\n            \n            <p>Thank you for using Finance App!</p>\n          </div>\n          \n          <div class=\"footer\">\n            <p>This is an automated message from Finance App. Please do not reply to this email.</p>\n          </div>\n        </div>\n      </body>\n      </html>\n    `;\n  }\n\n  private generateLoginEmailText(data: LoginEmailData): string {\n    const loginTime = data.loginTime.toLocaleString();\n    const ipInfo = data.ipAddress ? `IP Address: ${data.ipAddress}\\n` : \"\";\n    const userAgentInfo = data.userAgent ? `Device: ${data.userAgent}\\n` : \"\";\n\n    return `\nNew Login Notification\n\nHello ${data.userName},\n\nWe detected a new login to your Finance App account.\n\nLogin Details:\nTime: ${loginTime}\n${ipInfo}${userAgentInfo}\nIf this was you, you can safely ignore this email. If you don't recognize this login, please contact our support team immediately.\n\nThank you for using Finance App!\n\n---\nThis is an automated message from Finance App. Please do not reply to this email.\n    `.trim();\n  }\n}\n\nexport default LoginEmailService;\nexport type { LoginEmailData };\n"]}